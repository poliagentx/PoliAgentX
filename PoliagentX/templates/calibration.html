{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="min-h-screen bg-white py-12 px-4 sm:px-6 lg:px-8">
  <div class="max-w-7xl mx-auto space-y-8">

    <div class="bg-white shadow-lg rounded-xl p-6 mb-6">
      <h1 class="text-4xl font-bold text-black mb-4">Calibration</h1>
      <p class="text-[#0b0b0b] mb-4 leading-relaxed">
        This step allows you to calibrate the model parameters.
        Move the slider to set the calibration threshold and press
        ‚ÄúStart Calibration‚Äù.
      </p>
    </div>

    <div>
      <form id="calibration-form" method="POST" action="{% url 'start_calibration' %}"
        class="bg-white rounded-lg p-6 shadow-md space-y-6">
        {% csrf_token %}
        <h1 class="text-xl font-semibold">Calibration quality</h1>
        <p class="text-lg text-[#0b0b0b] leading-relaxed">
          You can determine how good the calibration quality should be. The higher the quality, the more time it takes to calibrate the model. If the calibration is taking too long, you can reset it and choose a lower quality. For quick tests, it is advisable to use a quality value around 0.3. Once you are sure about the type of exercise and the data that you plan to use, you can calibrate the model at a higher quality. A quality of 1 is theoretically the highest, but it is unachievable in practical terms due to the stochasticity of the model.
        </p>

        <div class="text-center space-y-2">
          <div id="slider-value" class="text-xl font-semibold text-black">0.70</div>
          <input type="range" id="slider" name="threshold"
            min="0.05" max="0.99" step="0.01" value="0.70"
            class="w-full h-2 bg-black rounded appearance-none focus:outline-none">
        </div>

        <button id="start-calibration-button" type="submit"
          class="w-full   tracking-wide 
         bg-gradient-to-r from-[#0b0b0b]/20 to-[#0b0b0b]/10
          backdrop-blur-xl border border-gray-50 
          text-[#0b0b0b] shadow-[0_4px_20px_rgba(0,0,0,0.4)]
          hover:shadow-[0_0_20px_rgba(0,255,200,0.6)]   
          transition-all duration-500 ease-in-out
           py-2 font-medium">
          START CALIBRATION
        </button>
      </form>
    </div>

    <!-- NEXT button area -->
    <div class="bg-white shadow-lg rounded-xl p-6 mb-6 text-right">
      {% if request.session.calibrated %}
        <!-- ‚úÖ Enabled if calibration done -->
        <a href="{% url 'simulation' %}"
          class="inline-block mt-4 px-6 py-2 
          font-semibold tracking-wide 
          bg-gradient-to-r from-[#0b0b0b]/20 to-[#0b0b0b]/10
          backdrop-blur-xl border border-white/20 
          text-[#0b0b0b] shadow-[0_4px_20px_rgba(0,0,0,0.4)]
          hover:shadow-[0_0_20px_rgba(0,255,200,0.6)]   
          transition-all duration-500 ease-in-out">
          NEXT ‚Üí
        </a>
      {% else %}
        <!-- üö´ Disabled until calibration done -->
        <button disabled
          class="inline-block px-6 py-2 bg-gray-400 text-white font-semibold rounded cursor-not-allowed">
          NEXT ‚Üí
        </button>
      {% endif %}
    </div>
  </div>
</div>

<script>
  const slider = document.getElementById("slider");
  const display = document.getElementById("slider-value");

  // Show live slider value
  slider.addEventListener("input", function () {
    display.textContent = parseFloat(this.value).toFixed(2);
  });

  // Disable double clicks while calibration runs
  const form = document.getElementById("calibration-form");
  form.addEventListener("submit", () => {
    const submitBtn = form.querySelector('button[type="submit"]');
    submitBtn.disabled = true;
    submitBtn.textContent = "Calibrating...";
  });
</script>


{% endblock %}
