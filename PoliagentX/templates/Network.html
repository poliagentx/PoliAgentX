{% extends 'base.html' %}
{% load crispy_forms_tags %}


{% block content %}
{% load static %}
<div class="bg-white py-8 px-4 sm:py-12 sm:px-6 lg:px-8">
    <div class="max-w-7xl mx-auto">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">


      <!-- Left Instructions -->
      <div>
        <h1 class="text-4xl font-bold text-black mb-4">Network of Interdependencies</h1>
      <p class="text-gray-700 mb-4 leading-[1.9em]">
          One of the model’s inputs is a network
          of conditional dependencies between all the indicators in the data. In the online
          app, the user can provide a file containing a matrix that captures such network.
        </p>
        <p class="text-gray-700 mb-4 leading-relaxed">
          The template provided in this step of the workflow is organised in three sheets. The
          first sheet (labelled template_network) is where you must put the information about
          the interdependencies. The second sheet (labelled metadata) explains each column
          in the template. The third sheet (labelled example_network) provides an example
          network corresponding to the example synthetic data from the other two templates.
        </p>
        <p class="text-gray-700 mb-4 leading-relaxed">
          If you do not have data and only wish to experiment with the app, the template provides an "example" tab
          with synthetic data you can copy into the "template_network" tab.
        </p>
        
      <form action="{% url 'download_network_template' %}"   method="get">
        <button type="submit"
          class="group inline-flex items-center gap-2 mt-4 px-6 py-2
                font-semibold tracking-wide
                bg-gradient-to-r from-[#0b0b0b]/20 to-[#0b0b0b]/10
                backdrop-blur-xl border border-white/20
                text-[#0b0b0b] shadow-[0_4px_20px_rgba(0,0,0,0.4)]
                hover:shadow-[0_0_20px_rgba(0,255,200,0.6)]
                transition-all duration-500 ease-in-out">
          <!-- Download icon -->
          <svg class="w-5 h-5 shrink-0 transition-transform duration-300 group-hover:translate-y-0.5"
              viewBox="0 0 24 24" fill="none" aria-hidden="true"
              stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5"/>
            <path d="M7.5 10.5 12 15l4.5-4.5"/>
            <path d="M12 15V3"/>
          </svg>
          <span>Template</span>
        </button>
      </form>
      </div>

      <!-- Right Upload Form -->
      <div>
        <form action="{% url 'upload_network' %}" method="post" enctype="multipart/form-data" class="bg-gray-100 rounded-lg p-6 shadow-md" id="upload-form">
          {% csrf_token %}

          <!-- Message area -->
          {% if form.errors or messages %}
            <div class="mb-4">
              {% if form.errors %}
                <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative" role="alert">
                  {% for field in form %}
                    {% for error in field.errors %}
                      <p class="text-sm font-semibold">{{ error }}</p>
                    {% endfor %}
                  {% endfor %}
                  {% for error in form.non_field_errors %}
                    <p class="text-sm font-semibold"> {{ error }}</p>
                  {% endfor %}
                </div>
              {% endif %}

              {% if messages %}
                {% for message in messages %}
                  <div id="{% if message.tags == 'success' %}upload-success-message{% endif %}"
                       class="mt-2 p-3 rounded text-sm text-black bg-{% if message.tags == 'success' %}white{% else %}red{% endif %}-600">
                    {{ message }}
                  </div>
                {% endfor %}
              {% endif %}
            </div>
          {% endif %}

          <!-- Drag & Drop Zone -->
          <div id="drop-zone" class="border-2 border-dashed border-gray-300 p-6 rounded-lg bg-white text-center transition-all duration-300 hover:border-gray-500">
            <div class="mb-4">
              <svg class="mx-auto h-8 w-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M7 16V4h10v12m-5 4l-4-4h8l-4 4z" />
              </svg>
            </div>
            <p class="text-gray-700">Drag and drop your file here</p>
            <p class="text-sm text-gray-500 mb-4">Supported formats: xlsx, xls</p>

            <!-- Choose File Button -->
            <label for="{{ form.interdependency_network.id_for_label }}" class="cursor-pointer inline-block bg-black text-white px-4 py-2 rounded hover:bg-gray-800 mt-2">
              Choose File
            </label>
          </div>

          <!-- Crispy Form Input (rendered but hidden visually) -->
          <div class="hidden">
    
              <input type="file" id="fileInput" name="interdependency_network" accept=".xlsx,.xls">
          </div>


        </form>
      </div>
    </div>

  <div class="mt-6 flex justify-between items-center">
    <form method="post" action="{% url 'upload_network' %}" id="skip-form">
  {% csrf_token %}
   <button type="submit" name="skip-network" value="on" id="skip-button" 
    class="inline-block mt-4 px-4 py-2 border border-gray-700 text-black font-semibold rounded hover:bg-green-700">
    SKIP THIS STEP
</button>

</form>

    <!-- NEXT Button -->
  <div class="mt-12 pb-10 text-right">
    <div id="next-button-container" class="hidden">
    <button type="button" form="upload-form" id="next-button"
      class="inline-block mt-4 px-6 py-2 
          font-semibold tracking-wide 
         bg-gradient-to-r from-[#0b0b0b]/20 to-[#0b0b0b]/10
          backdrop-blur-xl border border-white/20 
          text-[#0b0b0b] shadow-[0_4px_20px_rgba(0,0,0,0.4)]
          hover:shadow-[0_0_20px_rgba(0,255,200,0.6)]   
          transition-all duration-500 ease-in-out">
      NEXT →
    </button>
</div>
<div id="next-disabled">
    <button disabled
      class="inline-block px-6 py-2 bg-gray-400 text-white font-semibold rounded cursor-not-allowed">
      NEXT →
    </button>
</div>
</div>
  </div>
</div>


<script src="{% static 'Js/network.js' %}"></script>

<script src="{% static 'Js/drag.js' %}"></script>


{% endblock %}
