{% extends 'base.html' %}
{% load crispy_forms_tags %}


{% block content %}
{% load static %}
<div class="bg-white py-8 px-4 sm:py-12 sm:px-6 lg:px-8">
    <div class="max-w-7xl mx-auto">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">


      <!-- Left Instructions -->
      <div>
        <h1 class="text-4xl font-bold text-[#cb8700] mb-4">Network of Interdependencies</h1>
      <p class="text-gray-700 mb-4 leading-[1.9em]">
          One of the model’s inputs is a network
          of conditional dependencies between all the indicators in the data. In the online
          app, the user can provide a file containing a matrix that captures such network.
        </p>
        <p class="text-gray-700 mb-4 leading-relaxed">
          The template provided in this step of the workflow is organised in three sheets. The
          first sheet (labelled template_network) is where you must put the information about
          the interdependencies. The second sheet (labelled metadata) explains each column
          in the template. The third sheet (labelled example_network) provides an example
          network corresponding to the example synthetic data from the other two templates.
        </p>
        <p class="text-gray-700 mb-4 leading-relaxed">
          If you do not have data and only wish to experiment with the app, the template provides an "example" tab
          with synthetic data you can copy into the "template_network" tab.
        </p>
        
      <form action="{% url 'download_network_template' %}"   method="get">
        <button type="submit"
          class="group inline-flex items-center gap-2 mt-4 px-6 py-2
                font-semibold tracking-wide
                bg-gradient-to-r from-[#0b0b0b]/20 to-[#0b0b0b]/10
                backdrop-blur-xl border border-white/20
                text-[#0b0b0b] shadow-[0_4px_20px_rgba(0,0,0,0.4)]
                hover:shadow-[0_0_20px_rgba(0,255,200,0.6)]
                transition-all duration-500 ease-in-out">
          <!-- Download icon -->
          <svg class="w-5 h-5 shrink-0 transition-transform duration-300 group-hover:translate-y-0.5"
              viewBox="0 0 24 24" fill="none" aria-hidden="true"
              stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5"/>
            <path d="M7.5 10.5 12 15l4.5-4.5"/>
            <path d="M12 15V3"/>
          </svg>
          <span>Template</span>
        </button>
      </form>
      </div>

      <!-- Right Upload Form -->
    <div>
       
      <form action="{% url 'upload_network' %}" method="post" enctype="multipart/form-data" class=" bg-gradient-to-r from-[#0b0b0b]/5 to-[#0b0b0b]/8 backdrop-blur-xl border border-white/20 
          text-[#0b0b0b] shadow-[0_4px_20px_rgba(0,0,0,0.4)] rounded-xl p-6 " id="upload-form">
          {% csrf_token %}

               <!-- Message area -->
  {% if messages %}
  {% for message in messages %}
    <div id="{% if message.tags == 'success' %}upload-success-message{% endif %}"
         class="mt-2 p-3 rounded text-sm flex items-center gap-2
                {% if message.tags == 'success' %}  {% else %} bg-red-100 text-red-800 {% endif %}">
      
      <!-- Success icon -->
      {% if message.tags == 'success' %}
         <svg class="w-10 h-10 text-green-600 flex-shrink-0" fill="currentColor" viewBox="0 0 24 24">
          <path fill-rule="evenodd" d="M21.856 10.303c.086.554.144 1.118.144 1.697 0 6.075-4.925 11-11 11s-11-4.925-11-11 4.925-11 11-11c2.347 0 4.518.741 6.304 1.993l-1.422 1.457c-1.408-.913-3.082-1.45-4.882-1.45-4.962 0-9 4.038-9 9s4.038 9 9 9c4.894 0 8.879-3.928 8.99-8.795l1.866-1.902zm-.952-8.136l-9.404 9.639-3.843-3.614-3.095 3.098 6.938 6.71 12.5-12.737-3.096-3.096z" clip-rule="evenodd"/>
        </svg>

       
      {% endif %}

      <!-- Error icon -->
      {% if message.tags == 'error' %}
        <svg class="w-5 h-5 text-red-600 flex-shrink-0" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      {% endif %}

      <!-- Message text -->
      <span>{{ message }}</span>
    </div>
  {% endfor %}
{% endif %}

          <!-- Drag & Drop Zone -->
         
          <div id="drop-zone" class="border-2 border-dashed border-green-500 p-6 rounded-lg bg-white text-center transition-all duration-300 hover:border-gray-500">
            <div class="mb-4">
               <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-11 w-11 text-gray-400"
                                         viewBox="0 0 24 24" fill="none"
                                         stroke="currentColor" stroke-width="1.8"
                                         stroke-linecap="round" stroke-linejoin="round"
                                         class="h-10 w-10 text-gray-700/90">
                                        <circle cx="12" cy="12" r="9.25"></circle>
                                        <path d="M12 16V8"></path>
                                        <path d="M8.75 11.25 12 8l3.25 3.25"></path>
                                        <path d="M8 16h8"></path>
                                    </svg>
            </div>
            <p class="text-gray-700">Drag and drop your file here</p>
            <p class="text-sm text-gray-500 mb-4">Supported formats: xlsx, xls</p>

            <!-- Choose File Button -->
            <label for="{{ form.interdependency_network.id_for_label }}" class="cursor-pointer inline-block px-4 py-2 mt-2 bg-gradient-to-r from-[#0b0b0b]/20 to-[#0b0b0b]/10
                                       backdrop-blur-xl border border-white/20
                                       text-[#0b0b0b]
                                       rounded-xl
                                       transition-all duration-500 ease-in-out font-bold">
              Choose File
            </label>
          </div>

          <!-- Crispy Form Input (rendered but hidden visually) -->
          <div class="hidden">
    
              <input type="file" id="fileInput" name="interdependency_network" accept=".xlsx,.xls">
          </div>


        </form>
      </div>
    </div>

  <div class="mt-6 flex justify-between items-center">
  <form method="post" action="{% url 'upload_network' %}" id="skip-form">
  {% csrf_token %}
  <button
    type="submit"
    name="skip-network"
    value="on"
    id="skip-button"
    class="inline-flex items-center gap-2 mt-4 px-4 py-2 font-semibold tracking-wide bg-gradient-to-r from-[#0b0b0b]/20 to-[#0b0b0b]/10
           backdrop-blur-xl border border-white/20 text-[#0b0b0b]
           shadow-[0_4px_20px_rgba(0,0,0,0.4)]
           hover:shadow-[0_0_20px_rgba(0,255,200,0.6)]
           transition-all duration-500 ease-in-out" >
    <!-- Skip icon -->
    <svg
      class="w-5 h-5 shrink-0"
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
      aria-hidden="true"
    >
      <!-- outlined triangle -->
      <path d="M5 5v14l8-7-8-7z" 
            fill="none" 
            stroke="currentColor" 
            stroke-width="2"/>
      <!-- filled vertical bar -->
      <rect x="17" y="5" width="2" height="14" fill="currentColor"/>
    </svg>

    <span aria-hidden="true">SKIP THIS STEP</span>
  </button>
</form>


    <!-- NEXT Button -->
  <div class="mt-12 pb-10 text-right">
    <div id="next-button-container" class="hidden">
    <button type="button" form="upload-form" id="next-button"
      class="inline-block mt-4 px-6 py-2 
          font-semibold tracking-wide 
         bg-gradient-to-r from-[#0b0b0b]/20 to-[#0b0b0b]/10
          backdrop-blur-xl border border-white/20 
          text-[#0b0b0b] shadow-[0_4px_20px_rgba(0,0,0,0.4)]
          hover:shadow-[0_0_20px_rgba(0,255,200,0.6)]   
          transition-all duration-500 ease-in-out" data-next-url="{% url 'calibration' %}">
      NEXT →
    </button>
</div>
<div id="next-disabled">
    <button disabled
      class="inline-block px-6 py-2 bg-gray-400 text-white font-semibold rounded cursor-not-allowed">
      NEXT →
    </button>
</div>
</div>
  </div>
</div>
<script src="{% static 'Js/network.js' %}"></script>

{% endblock %}
