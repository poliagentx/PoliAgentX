{% extends 'base.html' %}
{% load crispy_forms_tags %}


{% block content %}
{% load static %}
<div class="min-h-screen bg-white py-12 px-4 sm:px-6 lg:px-8">
  <div class="max-w-7xl mx-auto">
    <div class="grid md:grid-cols-2 gap-8 items-start">

      <!-- Left Instructions -->
      <div>
        <h1 class="text-4xl font-bold text-black mb-4">Indicators</h1>
        <p class="text-gray-700 mb-4">
          Please upload the data associated to the development indicators that you wish to analyse.
          You should download the spreadsheet template and consult the "metadata" tab for an explanation
          on how each variable should be formatted. The app will run a quality check to ensure the format is correct.
        </p>
        <p class="text-gray-700 mb-4">
          If you do not have data and only wish to experiment with the app, the template provides an "example" tab
          with synthetic data you can copy into the "template" tab.
        </p>
        <a href="{% url 'download_template' %}" 
           class="inline-block mt-4 px-4 py-2 border border-gray-700 text-black font-semibold rounded hover:bg-green-700">
          Download template
        </a>
      </div>

      <!-- Right Upload Form -->
      <div>
        <form method="post" enctype="multipart/form-data" class="bg-gray-100 rounded-lg p-6 shadow-md" id="upload-form">
          {% csrf_token %}

          <!-- Message area -->
          {% if form.errors or messages %}
            <div class="mb-4">
              {% if form.errors %}
                <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative" role="alert">
                  {% for field in form %}
                    {% for error in field.errors %}
                      <p class="text-sm font-semibold">{{ error }}</p>
                    {% endfor %}
                  {% endfor %}
                  {% for error in form.non_field_errors %}
                    <p class="text-sm font-semibold"> {{ error }}</p>
                  {% endfor %}
                </div>
              {% endif %}

              {% if messages %}
                {% for message in messages %}
                  <div id="{% if message.tags == 'success' %}upload-success-message{% endif %}"
                       class="mt-2 p-3 rounded text-sm text-black bg-{% if message.tags == 'success' %}white{% else %}red{% endif %}-600">
                    {{ message }}
                  </div>
                {% endfor %}
              {% endif %}
            </div>
          {% endif %}

          <!-- Drag & Drop Zone -->
          <div id="drop-zone" class="border-2 border-dashed border-gray-300 p-6 rounded-lg bg-white text-center transition-all duration-300 hover:border-gray-500">
            <div class="mb-4">
              <svg class="mx-auto h-8 w-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M7 16V4h10v12m-5 4l-4-4h8l-4 4z" />
              </svg>
            </div>
            <p class="text-gray-700">Drag and drop your file here</p>
            <p class="text-sm text-gray-500 mb-4">Supported formats: xlsx, xls</p>

            <!-- Choose File Button -->
            <label for="file-upload" class="cursor-pointer inline-block bg-black text-white px-4 py-2 rounded hover:bg-gray-800 mt-2">
              Choose File
            </label>
          </div>

          <!-- Crispy Form Input (rendered but hidden visually) -->
          <div class="hidden">
            {{ form|crispy }}
          </div>

        </form>
      </div>
    </div>

    <!-- Download Link -->
    <!-- {% if download_link %}
      <div class="mt-6">
        <a href="{{ MEDIA_URL }}{{ download_link }}" 
           class="inline-block px-4 py-2 bg-green-600 text-white font-semibold rounded hover:bg-green-700"
           download>
          Download Processed Excel
        </a>
      </div>
    {% endif %} -->

    <!-- NEXT Button -->
    <div class="mt-6 text-right">
      <div id="next-button-container" class="hidden">
        <a href="{% url 'upload_expenditure' %}" class="inline-block px-6 py-2 bg-green-600 text-white font-semibold rounded hover:bg-green-700">
          NEXT →
        </a>
      </div>
      <div id="next-disabled">
        <button disabled class="inline-block px-6 py-2 bg-gray-400 text-white font-semibold rounded cursor-not-allowed">
          NEXT →
        </button>
      </div>
    </div>
  </div>
</div>


<script src="{% static 'Js/nextButton.js' %}"></script>



{% endblock %}
